<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idol Searcher</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root {
        --bg: #0d0d0d;
        --card: #1b1b1b;
        --accent: #ff7bcb;
        --text: #f1f1f1;
    }

    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "Poppins", sans-serif;
        display: flex;
        height: 100vh;
    }

    /* ───────────────────── Sidebar ───────────────────── */

    #sidebar {
        width: 260px;
        background: #111;
        border-right: 1px solid #333;
        overflow-y: auto;
        padding: 10px;
    }

    h2 {
        font-size: 18px;
        margin: 12px 0 6px;
        color: var(--accent);
    }

    .btn {
        background: var(--card);
        border: 1px solid #333;
        padding: 8px 10px;
        margin: 4px 0;
        border-radius: 6px;
        width: 100%;
        text-align: left;
        color: var(--text);
        cursor: pointer;
        transition: 0.2s;
    }

    .btn:hover {
        background: #272727;
        border-color: var(--accent);
        color: var(--accent);
    }

    .btn.active {
        background: #2a2a2a;
        border-color: var(--accent);
        color: var(--accent);
    }

    /* ───────────────────── Gallery Grid ───────────────────── */

    #gallery {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 12px;
    }

    .thumb {
        border-radius: 10px;
        border: 1px solid #333;
        overflow: hidden;
        cursor: pointer;
        background: #000;
        transition: 0.15s;
    }

    .thumb:hover {
        transform: scale(1.03);
        border-color: var(--accent);
    }

    .thumb img, .thumb video {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    /* ───────────────────── Viewer Modal ───────────────────── */

    #viewer {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.85);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 200;
    }

    #viewerContent img, #viewerContent video {
        max-width: 95vw;
        max-height: 90vh;
        border-radius: 12px;
        border: 2px solid var(--accent);
    }

    #closeViewer {
        position: absolute;
        top: 20px;
        right: 30px;
        background: #000;
        padding: 6px 12px;
        border: 1px solid #555;
        border-radius: 6px;
        cursor: pointer;
        color: #fff;
        font-size: 16px;
    }
</style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
    <h2>Idols</h2>
    <div id="idolList"></div>

    <h2>Categories</h2>
    <div id="categoryList"></div>
</div>

<!-- Thumbnails -->
<div id="gallery"></div>

<!-- Viewer Modal -->
<div id="viewer">
    <button id="closeViewer">Close</button>
    <div id="viewerContent"></div>
</div>

<script>
const MEDIA_URL_1 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links.txt";
const MEDIA_URL_2 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links_02.txt";
const CAT_URL     = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/categories.txt";

let catalog = [];
let categories = [];

let currentIdol = null;
let currentCategory = null;

const idolListEl = document.getElementById("idolList");
const categoryListEl = document.getElementById("categoryList");
const galleryEl = document.getElementById("gallery");
const viewer = document.getElementById("viewer");
const viewerContent = document.getElementById("viewerContent");
document.getElementById("closeViewer").onclick = () => viewer.style.display = "none";

/* ───────────────────── Load catalog ───────────────────── */
function parse(text) {
    return text.split("\n").map(l => l.trim()).filter(Boolean).map(line => {
        const p = line.split(",").map(x => x.trim());
        return { folder: p[0], raw: p[1], thumb: p[2], category: p[3] || "" };
    });
}

async function loadCatalog() {
    const [r1, r2] = await Promise.all([fetch(MEDIA_URL_1), fetch(MEDIA_URL_2)]);
    const [t1, t2] = await Promise.all([r1.text(), r2.text()]);
    catalog = [...parse(t1), ...parse(t2)];
    buildIdolButtons();
}

/* ───────────────────── Load categories ───────────────────── */
async function loadCategories() {
    const txt = await (await fetch(CAT_URL)).text();
    categories = txt.split("\n").map(x => x.trim()).filter(Boolean);
    buildCategoryButtons();
}

/* ───────────────────── Build sidebar buttons ───────────────────── */
function buildIdolButtons() {
    idolListEl.innerHTML = "";
    const idols = [...new Set(catalog.map(x => x.folder))];

    idols.forEach(name => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = name;
        b.onclick = () => selectIdol(name, b);
        idolListEl.appendChild(b);
    });
}

function buildCategoryButtons() {
    categoryListEl.innerHTML = "";
    categories.forEach(cat => {
        const b = document.createElement("button");
        b.className = "btn";
        b.textContent = cat;
        b.onclick = () => selectCategory(cat, b);
        categoryListEl.appendChild(b);
    });
}

/* ───────────────────── Filters ───────────────────── */
function selectIdol(name, btn) {
    currentIdol = name;
    currentCategory = null;
    highlightButtons(idolListEl, btn);
    highlightButtons(categoryListEl, null);
    renderGallery();
}

function selectCategory(cat, btn) {
    currentCategory = cat;
    currentIdol = null;
    highlightButtons(categoryListEl, btn);
    highlightButtons(idolListEl, null);
    renderGallery();
}

function highlightButtons(container, activeBtn) {
    [...container.children].forEach(b => b.classList.remove("active"));
    if (activeBtn) activeBtn.classList.add("active");
}

/* ───────────────────── Render Thumbnails Grid ───────────────────── */
function renderGallery() {
    galleryEl.innerHTML = "";

    let items = catalog;

    if (currentIdol) items = items.filter(x => x.folder === currentIdol);
    if (currentCategory) items = items.filter(x => x.category === currentCategory);

    items.forEach(item => {
        const div = document.createElement("div");
        div.className = "thumb";

        const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
        div.innerHTML = isVideo
            ? `<video src="${item.thumb || item.raw}" muted></video>`
            : `<img src="${item.thumb || item.raw}">`;

        div.onclick = () => openViewer(item);

        galleryEl.appendChild(div);
    });
}

/* ───────────────────── Viewer Modal ───────────────────── */
function openViewer(item) {
    viewer.style.display = "flex";

    const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
    viewerContent.innerHTML = isVideo
        ? `<video src="${item.raw}" autoplay controls></video>`
        : `<img src="${item.raw}">`;
}

/* ───────────────────── Init ───────────────────── */

loadCatalog();
loadCategories();

</script>
</body>
</html>
