<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ðŸŽµ Idol Searcher</title>
<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #0c0c0c;
  color: #eee;
}

/* ===== LEFT PANELS ===== */
#idolButtons {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 200px;
  background: #111;
  border-right: 1px solid #333;
  overflow-y: auto;
  padding: 10px;
  box-sizing: border-box;
  z-index: 999;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
#idolButtons::-webkit-scrollbar { display: none; }

#categoryButtons {
  position: fixed;
  top: 0;
  left: 200px;
  height: 100%;
  width: 200px;
  background: #141414;
  border-right: 1px solid #333;
  overflow-y: auto;
  padding: 10px;
  box-sizing: border-box;
  z-index: 998;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
#categoryButtons::-webkit-scrollbar { display: none; }

/* ===== MAIN PANEL ===== */
#mainPanel {
  margin-left: 400px;
  padding: 15px;
}

#searchBar {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #111;
  color: #fff;
}

#grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 10px;
}

.thumb {
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
  background: #000;
}

button {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  background: #222;
  color: #eee;
  border: 1px solid #333;
  border-radius: 6px;
  text-align: left;
  cursor: pointer;
}
button.active {
  background: #444;
}

#counter {
  margin-bottom: 10px;
  opacity: 0.8;
}
</style>
</head>
<body>

<div id="idolButtons"></div>
<div id="categoryButtons"></div>

<div id="mainPanel">
  <input id="searchBar" placeholder="Search..." />
  <div id="counter"></div>
  <div id="grid"></div>
</div>

<script>
let catalog = [];
let filteredCatalog = [];
let currentIdolFilter = null;
let currentCategoryFilter = null;

/* ======= NORMALIZED PARSER (FIXES 25 vs 30 BUG) ======= */
function parseCatalogText(text) {
  return text.split("\n").map(l=>{
    const p = l.split(",").map(x => x.trim());
    const folder = (p[0] || "").replace(/\s+/g, " ").trim();
    const raw = (p[1] || "").trim();
    const thumb = (p[2] || "").trim();
    const category = (p[3] || "").replace(/\s+/g, " ").trim();
    return { folder, raw, thumb, category };
  }).filter(x => x.folder && x.raw && x.thumb);
}

/* ======= FILTERING ======= */
function applyFilters() {
  const idolNorm = currentIdolFilter ? currentIdolFilter.trim().toLowerCase() : "";
  const catNorm = currentCategoryFilter ? currentCategoryFilter.trim().toLowerCase() : "";

  filteredCatalog = catalog.filter(it => {
    const folderNormalized = (it.folder || "").trim().toLowerCase();
    const categoryNormalized = (it.category || "").trim().toLowerCase();

    const idolMatch = !idolNorm || folderNormalized === idolNorm;
    const catMatch = !catNorm || categoryNormalized === catNorm;
    return idolMatch && catMatch;
  });

  renderGrid();
}

/* ======= RENDER IDOLS ======= */
function renderIdolButtons() {
  const map = {};
  catalog.forEach(it => {
    const key = it.folder;
    map[key] = (map[key] || 0) + 1;
  });

  const host = document.getElementById("idolButtons");
  host.innerHTML = "<b>Idols</b><br><br>";

  Object.keys(map).sort().forEach(idol => {
    const btn = document.createElement("button");
    btn.textContent = `${idol} (${map[idol]})`;
    if (currentIdolFilter === idol) btn.classList.add("active");
    btn.onclick = () => {
      currentIdolFilter = idol;
      renderIdolButtons();
      applyFilters();
    };
    host.appendChild(btn);
  });
}

/* ======= RENDER CATEGORIES ======= */
function renderCategoryButtons() {
  const map = {};
  catalog.forEach(it => {
    if (!it.category) return;
    map[it.category] = (map[it.category] || 0) + 1;
  });

  const host = document.getElementById("categoryButtons");
  host.innerHTML = "<b>Categories</b><br><br>";

  Object.keys(map).sort().forEach(cat => {
    const btn = document.createElement("button");
    btn.textContent = `${cat} (${map[cat]})`;
    if (currentCategoryFilter === cat) btn.classList.add("active");
    btn.onclick = () => {
      currentCategoryFilter = cat;
      renderCategoryButtons();
      applyFilters();
    };
    host.appendChild(btn);
  });
}

/* ======= GRID ======= */
function renderGrid() {
  const grid = document.getElementById("grid");
  const counter = document.getElementById("counter");
  counter.textContent = `${filteredCatalog.length} items`; 
  grid.innerHTML = "";

  filteredCatalog.forEach(it => {
    const img = document.createElement("img");
    img.src = it.thumb;
    img.className = "thumb";
    img.onclick = () => window.open(it.raw, "_blank");
    grid.appendChild(img);
  });
}

/* ======= SEARCH ======= */
const searchBar = document.getElementById("searchBar");
searchBar.oninput = () => {
  const q = searchBar.value.toLowerCase();
  filteredCatalog = catalog.filter(it =>
    it.folder.toLowerCase().includes(q) ||
    it.category.toLowerCase().includes(q)
  );
  renderGrid();
};

/* ======= LOAD DATA ======= */
fetch("catalog.txt")
  .then(r => r.text())
  .then(text => {
    catalog = parseCatalogText(text);
    filteredCatalog = catalog.slice();

    renderIdolButtons();
    renderCategoryButtons();
    applyFilters();
  });
</script>
</body>
</html>
