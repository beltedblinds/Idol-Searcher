<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idol Searcher</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root {
        --bg: #0d0d0d;
        --card: #1b1b1b;
        --accent: #ff7bcb;
        --accent-hover: #ff94d8;
        --text: #f1f1f1;
    }

    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "Poppins", sans-serif;
        display: flex;
        height: 100vh;
    }

    /* ───────────────────── Panels (MATCHES IDOL SHUFFLER) ───────────────────── */

    #idolPanel {
        width: 200px;
        background: #111;
        border-right: 1px solid #333;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    #categoryPanel {
        width: 160px;
        background: #111;
        border-right: 1px solid #333;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    h2 {
        font-size: 16px;
        margin: 10px 0 4px;
        color: var(--accent);
    }

    .side-btn {
        background: var(--card);
        border: 1px solid #333;
        padding: 8px 10px;
        border-radius: 8px;
        width: 100%;
        color: var(--text);
        cursor: pointer;
        font-size: 13px;
        text-align: left;
        transition: 0.2s;
    }

    .side-btn:hover {
        background: #272727;
        border-color: var(--accent);
        color: var(--accent-hover);
    }

    .side-btn.active {
        background: #272727;
        border-color: var(--accent);
        color: var(--accent);
    }

    /* ───────────────────── Thumbnails (EXACT IDOL SHUFFLER STYLE) ───────────────────── */

    #gallery {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: grid;
        gap: 14px;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }

    .thumb {
        width: 100%;
        aspect-ratio: 1 / 1; /* square just like saved thumbnails */
        background: #111;
        border-radius: 10px;
        border: 1px solid #333;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

    .thumb:hover {
        transform: scale(1.07);
        border-color: var(--accent);
    }

    .thumb img, 
    .thumb video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* ───────────────────── Modal viewer ───────────────────── */

    #viewer {
        position: fixed;
        inset: 0;
        display: none;
        justify-content: center;
        align-items: center;
        background: rgba(0,0,0,0.9);
        z-index: 200;
    }

    #viewerContent img,
    #viewerContent video {
        max-width: 95vw;
        max-height: 92vh;
        border-radius: 12px;
        border: 2px solid var(--accent);
    }

    #closeViewer {
        position: absolute;
        top: 20px;
        right: 30px;
        background: #000;
        padding: 6px 12px;
        border: 1px solid #555;
        border-radius: 6px;
        color: #fff;
        cursor: pointer;
    }
</style>
</head>
<body>

<!-- LEFT PANELS – SAME STRUCTURE AS IDOL SHUFFLER -->
<div id="idolPanel">
    <h2>Idols</h2>
    <div id="idolList"></div>
</div>

<div id="categoryPanel">
    <h2>Categories</h2>
    <div id="categoryList"></div>
</div>

<!-- THUMBNAIL GALLERY -->
<div id="gallery"></div>

<!-- VIEWER -->
<div id="viewer">
    <button id="closeViewer">Close</button>
    <div id="viewerContent"></div>
</div>

<script>
/* DATA SOURCES (same as Idol-Shuffler) */
const MEDIA1 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links.txt";
const MEDIA2 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links_02.txt";
const CATFILE = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/categories.txt";

let catalog = [];
let categories = [];

let currentIdol = null;
let currentCategory = null;

/* ELEMENTS */
const idolList = document.getElementById("idolList");
const categoryList = document.getElementById("categoryList");
const gallery = document.getElementById("gallery");

const viewer = document.getElementById("viewer");
const viewerContent = document.getElementById("viewerContent");
document.getElementById("closeViewer").onclick = () => (viewer.style.display = "none");

/* PARSER */
function parse(text) {
    return text.split("\n").map(l => l.trim()).filter(Boolean).map(l => {
        const p = l.split(",").map(x => x.trim());
        return { folder: p[0], raw: p[1], thumb: p[2], category: p[3] || "" };
    });
}

/* LOAD DATA */
async function loadCatalog() {
    const [r1, r2] = await Promise.all([fetch(MEDIA1), fetch(MEDIA2)]);
    const [t1, t2] = await Promise.all([r1.text(), r2.text()]);
    catalog = [...parse(t1), ...parse(t2)];
    buildIdolButtons();
}

async function loadCategories() {
    const txt = await (await fetch(CATFILE)).text();
    categories = txt.split("\n").map(x => x.trim()).filter(Boolean);
    buildCategoryButtons();
}

/* PANELS */
function buildIdolButtons() {
    idolList.innerHTML = "";
    const idols = [...new Set(catalog.map(x => x.folder))];

    idols.forEach(name => {
        const btn = document.createElement("button");
        btn.className = "side-btn";
        btn.textContent = name;
        btn.onclick = () => selectIdol(name, btn);
        idolList.appendChild(btn);
    });
}

function buildCategoryButtons() {
    categoryList.innerHTML = "";
    categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.className = "side-btn";
        btn.textContent = cat;
        btn.onclick = () => selectCategory(cat, btn);
        categoryList.appendChild(btn);
    });
}

function highlight(group, activeBtn) {
    [...group.children].forEach(b => b.classList.remove("active"));
    if (activeBtn) activeBtn.classList.add("active");
}

/* FILTER SELECTORS */
function selectIdol(name, btn) {
    currentIdol = name;
    currentCategory = null;
    highlight(idolList, btn);
    highlight(categoryList, null);
    renderGallery();
}

function selectCategory(cat, btn) {
    currentCategory = cat;
    currentIdol = null;
    highlight(categoryList, btn);
    highlight(idolList, null);
    renderGallery();
}

/* RENDER THUMBNAILS (MATCHES IDOL SHUFFLER STYLE) */
function renderGallery() {
    gallery.innerHTML = "";

    let items = catalog;
    if (currentIdol) items = items.filter(x => x.folder === currentIdol);
    if (currentCategory) items = items.filter(x => x.category === currentCategory);

    items.forEach(item => {
        const div = document.createElement("div");
        div.className = "thumb";

        const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
        div.innerHTML = isVideo
            ? `<video src="${item.thumb || item.raw}" muted></video>`
            : `<img src="${item.thumb || item.raw}">`;

        div.onclick = () => openViewer(item);

        gallery.appendChild(div);
    });
}

/* VIEWER */
function openViewer(item) {
    viewer.style.display = "flex";
    const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
    viewerContent.innerHTML = isVideo
        ? `<video src="${item.raw}" autoplay controls></video>`
        : `<img src="${item.raw}">`;
}

/* INIT */
loadCatalog();
loadCategories();
</script>
</body>
</html>
