<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idol Searcher</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    :root {
        --bg: #0e0e0e;
        --panel: #111;
        --card: #1a1a1a;
        --accent: #ff7bcb;
        --accent-soft: #ff9ed6;
        --text: #f5f5f5;
    }

    body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "Poppins", sans-serif;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    /* ───────────────────────────
       LEFT PANELS (Same layout as Idol Shuffler)
       ─────────────────────────── */
    #idolPanel {
        width: 210px;
        background: var(--panel);
        border-right: 1px solid #2a2a2a;
        padding: 10px;
        overflow-y: auto;
    }

    #categoryPanel {
        width: 170px;
        background: var(--panel);
        border-right: 1px solid #2a2a2a;
        padding: 10px;
        overflow-y: auto;
    }

    h2 {
        margin: 10px 0 6px;
        font-size: 15px;
        color: var(--accent);
    }

    .side-btn {
        background: var(--card);
        border: 1px solid #2d2d2d;
        padding: 8px;
        margin-bottom: 6px;
        border-radius: 8px;
        color: var(--text);
        width: 100%;
        cursor: pointer;
        font-size: 13px;
        transition: 0.2s;
        text-align: left;
    }

    .side-btn:hover {
        background: #262626;
        border-color: var(--accent);
        color: var(--accent-soft);
    }

    .side-btn.active {
        background: #2b2b2b;
        border-color: var(--accent);
        color: var(--accent);
    }

    /* ───────────────────────────
       TRUE IDOL-SHUFFLER THUMBNAIL CSS
       ─────────────────────────── */

    #gallery {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: grid;
        gap: 18px;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* identical behavior */
        background: var(--bg);
    }

    .thumb {
        background: var(--card);
        border-radius: 12px;
        border: 1px solid #333;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
    }

    .thumb:hover {
        transform: scale(1.04);
        border-color: var(--accent);
        box-shadow: 0 0 10px rgba(255, 122, 203, 0.45);
    }

    /* Natural-sized thumbnails — EXACT Shuffler behavior */
    .thumb img,
    .thumb video {
        width: 100%;
        height: auto;
        object-fit: cover;  /* same as shuffler */
        display: block;
    }

    /* ───────────────────────────
       VIEWER
       ─────────────────────────── */
    #viewer {
        position: fixed;
        inset: 0;
        display: none;
        justify-content: center;
        align-items: center;
        background: rgba(0,0,0,0.88);
        z-index: 999;
    }

    #viewerContent img,
    #viewerContent video {
        max-width: 95vw;
        max-height: 92vh;
        border-radius: 12px;
        border: 2px solid var(--accent);
    }

    #closeViewer {
        position: absolute;
        top: 20px;
        right: 30px;
        background: #000;
        padding: 7px 14px;
        color: white;
        border: 1px solid #555;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
    }

</style>
</head>
<body>

<!-- PANELS -->
<div id="idolPanel">
    <h2>Idols</h2>
    <div id="idolList"></div>
</div>

<div id="categoryPanel">
    <h2>Categories</h2>
    <div id="categoryList"></div>
</div>

<!-- GALLERY -->
<div id="gallery"></div>

<!-- VIEWER -->
<div id="viewer">
    <button id="closeViewer">Close</button>
    <div id="viewerContent"></div>
</div>

<script>
/* Data sources */
const MEDIA1 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links.txt";
const MEDIA2 = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/idol_gallery_links_02.txt";
const CATFILE = "https://raw.githubusercontent.com/beltedblinds/Idol-Categorizer/main/categories.txt";

let catalog = [];
let categories = [];

let currentIdol = null;
let currentCategory = null;

/* Elements */
const idolList = document.getElementById("idolList");
const categoryList = document.getElementById("categoryList");
const gallery = document.getElementById("gallery");

const viewer = document.getElementById("viewer");
const viewerContent = document.getElementById("viewerContent");
document.getElementById("closeViewer").onclick = () => viewer.style.display = "none";

/* Parse catalog line */
function parse(txt) {
    return txt.split("\n")
        .map(l => l.trim())
        .filter(Boolean)
        .map(line => {
            const p = line.split(",").map(x => x.trim());
            return {
                folder: p[0],
                raw: p[1],
                thumb: p[2],
                category: p[3] || ""
            };
        });
}

/* Load data */
async function loadCatalog() {
    const [r1, r2] = await Promise.all([fetch(MEDIA1), fetch(MEDIA2)]);
    const [t1, t2] = await Promise.all([r1.text(), r2.text()]);
    catalog = [...parse(t1), ...parse(t2)];
    buildIdolButtons();
}

async function loadCategories() {
    const t = await (await fetch(CATFILE)).text();
    categories = t.split("\n").map(x => x.trim()).filter(Boolean);
    buildCategoryButtons();
}

/* Sidebar buttons */
function buildIdolButtons() {
    idolList.innerHTML = "";
    const idols = [...new Set(catalog.map(x => x.folder))];

    idols.forEach(name => {
        const b = document.createElement("button");
        b.className = "side-btn";
        b.textContent = name;
        b.onclick = () => selectIdol(name, b);
        idolList.appendChild(b);
    });
}

function buildCategoryButtons() {
    categoryList.innerHTML = "";
    categories.forEach(cat => {
        const b = document.createElement("button");
        b.className = "side-btn";
        b.textContent = cat;
        b.onclick = () => selectCategory(cat, b);
        categoryList.appendChild(b);
    });
}

function highlight(group, active) {
    [...group.children].forEach(b => b.classList.remove("active"));
    if (active) active.classList.add("active");
}

/* Selection */
function selectIdol(name, btn) {
    currentIdol = name;
    currentCategory = null;
    highlight(idolList, btn);
    highlight(categoryList, null);
    renderGallery();
}

function selectCategory(cat, btn) {
    currentCategory = cat;
    currentIdol = null;
    highlight(categoryList, btn);
    highlight(idolList, null);
    renderGallery();
}

/* Render thumbnails */
function renderGallery() {
    gallery.innerHTML = "";

    let items = catalog;
    if (currentIdol) items = items.filter(x => x.folder === currentIdol);
    if (currentCategory) items = items.filter(x => x.category === currentCategory);

    items.forEach(item => {
        const div = document.createElement("div");
        div.className = "thumb";

        const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
        div.innerHTML = isVideo
            ? `<video src="${item.thumb || item.raw}" muted></video>`
            : `<img src="${item.thumb || item.raw}">`;

        div.onclick = () => openViewer(item);
        gallery.appendChild(div);
    });
}

/* Viewer */
function openViewer(item) {
    viewer.style.display = "flex";

    const isVideo = /\.(mp4|webm|mov)$/i.test(item.raw);
    viewerContent.innerHTML = isVideo
        ? `<video src="${item.raw}" controls autoplay></video>`
        : `<img src="${item.raw}">`;
}

/* Init */
loadCatalog();
loadCategories();
</script>
</body>
</html>
